# three-tier-architecture

The code in this repo is an 3-tier(App,Web and DB Tier) environment setup. I have used Terraform as a IaC(Infrastructure as Code) tool to build the environment. For resusability purpose I have created this code as an module and called when ever required.

## Requirements

- AWS Account Credentials.
- Terraform installed environment. To download the necessary Terraform binary refer [here](https://www.terraform.io/downloads).
- VS Code(In case you need to edit your code). To know about it refere [here](https://www.terraform.io/downloads)

## Providers

```shell
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 3.0"
    }
  }
}
```
## Inputs

- VPC Input:

```text
aws_cidr_block                 CIDR Block for creating the VPC(Default: 10.0.0.0/16)
aws_public_subnet_1            CIDR Block for creating the Public Subnet 1 will be used for Availability Zone A(Default: 10.0.1.0/24)
aws_public_subnet_2            CIDR Block for creating the Public Subnet 2 will be used for Availability Zone B(Default: 10.0.2.0/24)
aws_private_subnet_3           CIDR Block for creating the Private Subnet 1 will be used for Availability Zone A(Default: 10.0.3.0/24)
aws_private_subnet_4           CIDR Block for creating the Private Subnet 2 will be used for Availability Zone B(Default: 10.0.4.0/24)
aws_availability_zone_A        AWS Availability Zone Name(default: us-east-1a)
aws_availability_zone_B        AWS Availability Zone Name(default: us-east-1b)
aws_any_ip                     IP CIDR which is to allow any access to the instances(default: 0.0.0.0/0)
```
- ASG Input:

```text
min_asg_value                       Autoscaling group Minimum instance need to provisioned.(Deafult: 2)
max_asg_value                       Autoscaling group Maximum instance need to provisioned while the ASG Scales up.(Default: 4)
```
- AWS Common Input:

```text
region                              Region of the AWS Account where you need to deploy the resources.
aws_profile                         AWS Profile need to be selected in order to Terraform authenticate to the AWS Accounts.(Example: default)
```
- AWS EC2 Input:

```text
aws_instance_type                   AWS EC2 Instance type selection. (Default: t3.micro)
ami_id                              AWS AMI Id. The image id of the Operating system need to be deployed inside the AWS.(Default Amazon Linux AMI2: ami-0ed9277fb7eb570c9)
```
- AWS RDS DB Input:

```text
mysql_db_allocated_storage          Custom DB Size for AWS RDS Database Storage(Default: 30). Here 30 refers 30 GB.
mysql_db_storage_type               Choose the AWS RDS DB Storage Type. (Default: 'gp2')
mysql_db_engine                     Choose the AWS RDS DB Engine. (Defualt: mysql)
mysql_db_engine_version             Choose the AWS RDS DB Engine version. (Defualt: 8.0.20)
mysql_db_instance_class             Choose the Size of the AWS RDS Instance.(Defualt: db.t3.micro)
mysql_db_name                       Custom MySQL DB Name: (Example: demords)
mysql_db_username                   Custom MySQL DB Username.(Example: demordsadmin)
mysql_db_password                   Strong MySQL DB Password.(Example: Uas38y3yQWha1gVxB)
mysql_db_multi_az                   Used for the purpose of creating RDS two availability zones(Master/Slave concept) for resilence purpose.(Defualt: True)
mysql_db_port                       MySQL DB port configuration.(Defualt: 3306)
```

### Configure environment variables

```shell
aws configure
AWS Access Key ID : AKIAIOSFODNN7EXAMPLE
AWS Secret Access Key : wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
Default region name : us-east-1
```

## Usage

Named `terraform-<PROVIDER>-<NAME>`. Module repositories must use this three-part name format.

```shell
curl -fsSL https://raw.githubusercontent.com/tmknom/template-terraform-module/master/install | sh -s terraform-aws-sample
cd terraform-aws-sample && make install
```

## Examples

- [Minimal](https://github.com/tmknom/template-terraform-module/tree/master/examples/minimal)
- [Complete](https://github.com/tmknom/template-terraform-module/tree/master/examples/complete)

<!-- BEGINNING OF GENERATED BY TERRAFORM-DOCS -->

## Requirements

Write your Terraform module requirements.

## Providers

Write your Terraform module providers.

## Inputs

Write your Terraform module inputs.

## Outputs

Write your Terraform module outputs.

<!-- END OF GENERATED BY TERRAFORM-DOCS -->

## Development

### Development Requirements

- [Docker](https://www.docker.com/)

### Configure environment variables

```shell
export AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
export AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
export AWS_DEFAULT_REGION=ap-northeast-1
```

### Installation

```shell
git clone git@github.com:tmknom/template-terraform-module.git
cd template-terraform-module
make install
```

### Makefile targets

```text
apply-complete                 Run terraform apply examples/complete
apply-minimal                  Run terraform apply examples/minimal
check-format                   Check format code
clean                          Clean .terraform
destroy-complete               Run terraform destroy examples/complete
destroy-minimal                Run terraform destroy examples/minimal
diff                           Word diff
docs                           Generate docs
format                         Format code
help                           Show help
install                        Install requirements
lint                           Lint code
plan-complete                  Run terraform plan examples/complete
plan-minimal                   Run terraform plan examples/minimal
release                        Release GitHub and Terraform Module Registry
upgrade                        Upgrade makefile
```

### Releasing new versions

Bump VERSION file, and run `make release`.

### Terraform Module Registry

- <https://registry.terraform.io/modules/tmknom/name/provider>

## License

Apache 2 Licensed. See LICENSE for full details.
